{"version":3,"file":"bleClient.js","sourceRoot":"","sources":["../../src/bleClient.ts"],"names":[],"mappings":"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","sourcesContent":["import type { PluginListenerHandle } from '@capacitor/core';\nimport { Capacitor } from '@capacitor/core';\n\nimport type { DisplayStrings } from './config';\nimport { dataViewToHexString, hexStringToDataView } from './conversion';\nimport type {\n  BleDevice,\n  BleService,\n  Data,\n  InitializeOptions,\n  ReadResult,\n  RequestBleDeviceOptions,\n  ScanResult,\n  ScanResultInternal,\n  TimeoutOptions,\n} from './definitions';\nimport { BluetoothLe } from './plugin';\nimport { getQueue } from './queue';\nimport { validateUUID } from './validators';\n\nexport interface BleClientInterface {\n  /**\n   * Initialize Bluetooth Low Energy (BLE). If it fails, BLE might be unavailable on this device.\n   * On **Android** it will ask for the location permission. On **iOS** it will ask for the Bluetooth permission.\n   * For an example, see [usage](#usage).\n   */\n  initialize(options?: InitializeOptions): Promise<void>;\n\n  /**\n   * Reports whether Bluetooth is enabled on this device.\n   * Always returns `true` on **web**.\n   */\n  isEnabled(): Promise<boolean>;\n\n  /**\n   * Enable Bluetooth.\n   * Only available on **Android**.\n   */\n  enable(): Promise<void>;\n\n  /**\n   * Disable Bluetooth.\n   * Only available on **Android**.\n   */\n  disable(): Promise<void>;\n\n  /**\n   * Register a callback function that will be invoked when Bluetooth is enabled (true) or disabled (false) on this device.\n   * Not available on **web** (the callback will never be invoked).\n   * @param callback Callback function to use when the Bluetooth state changes.\n   */\n  startEnabledNotifications(callback: (value: boolean) => void): Promise<void>;\n\n  /**\n   * Stop the enabled notifications registered with `startEnabledNotifications`.\n   */\n  stopEnabledNotifications(): Promise<void>;\n\n  /**\n   * Reports whether Location Services are enabled on this device.\n   * Only available on **Android**.\n   */\n  isLocationEnabled(): Promise<boolean>;\n\n  /**\n   * Open Location settings.\n   * Only available on **Android**.\n   */\n  openLocationSettings(): Promise<void>;\n\n  /**\n   * Open Bluetooth settings.\n   * Only available on **Android**.\n   */\n  openBluetoothSettings(): Promise<void>;\n\n  /**\n   * Open App settings.\n   * Not available on **web**.\n   * On **iOS** when a user declines the request to use Bluetooth on the first call of `initialize`, it is not possible\n   * to request for Bluetooth again from within the app. In this case Bluetooth has to be enabled in the app settings\n   * for the app to be able use it.\n   */\n  openAppSettings(): Promise<void>;\n\n  /**\n   * Set the strings that are displayed in the `requestDevice` dialog.\n   * @param displayStrings\n   */\n  setDisplayStrings(displayStrings: DisplayStrings): Promise<void>;\n\n  /**\n   * Request a peripheral BLE device to interact with. This will scan for available devices according to the filters in the options and show a dialog to pick a device.\n   * For an example, see [usage](#usage).\n   * @param options Device filters, see [RequestBleDeviceOptions](#RequestBleDeviceOptions)\n   */\n  requestDevice(options?: RequestBleDeviceOptions): Promise<BleDevice>;\n\n  /**\n   * Start scanning for BLE devices to interact with according to the filters in the options. The callback will be invoked on each device that is found.\n   * Scanning will continue until `stopLEScan` is called. For an example, see [usage](#usage).\n   * **NOTE**: Use with care on **web** platform, the required API is still behind a flag in most browsers.\n   * @param options\n   * @param callback\n   */\n  requestLEScan(options: RequestBleDeviceOptions, callback: (result: ScanResult) => void): Promise<void>;\n\n  /**\n   * Stop scanning for BLE devices. For an example, see [usage](#usage).\n   */\n  stopLEScan(): Promise<void>;\n\n  /**\n   * On iOS and web, if you want to connect to a previously connected device without scanning first, you can use `getDevice`.\n   * Uses [retrievePeripherals](https://developer.apple.com/documentation/corebluetooth/cbcentralmanager/1519127-retrieveperipherals) on iOS and\n   * [getDevices](https://developer.mozilla.org/en-US/docs/Web/API/Bluetooth/getDevices) on web.\n   * On Android, you can directly connect to the device with the deviceId.\n   * @param deviceIds List of device IDs, e.g. saved from a previous app run. No used on web.\n   */\n  getDevices(deviceIds: string[]): Promise<BleDevice[]>;\n\n  /**\n   * Get a list of currently connected devices.\n   * Uses [retrieveConnectedPeripherals](https://developer.apple.com/documentation/corebluetooth/cbcentralmanager/1518924-retrieveconnectedperipherals) on iOS,\n   * [getConnectedDevices](https://developer.android.com/reference/android/bluetooth/BluetoothManager#getConnectedDevices(int)) on Android\n   * and [getDevices](https://developer.mozilla.org/en-US/docs/Web/API/Bluetooth/getDevices) on web.\n   * @param services List of services to filter the devices by. If no service is specified, no devices will be returned. Only applies to iOS.\n   */\n  getConnectedDevices(services: string[]): Promise<BleDevice[]>;\n\n  /**\n   * Connect to a peripheral BLE device. For an example, see [usage](#usage).\n   * @param deviceId  The ID of the device to use (obtained from [requestDevice](#requestDevice) or [requestLEScan](#requestLEScan))\n   * @param onDisconnect Optional disconnect callback function that will be used when the device disconnects\n   * @param options Options for plugin call\n   */\n  connect(deviceId: string, onDisconnect?: (deviceId: string) => void, options?: TimeoutOptions): Promise<void>;\n\n  /**\n   * Create a bond with a peripheral BLE device.\n   * Only available on **Android**. On iOS bonding is handled by the OS.\n   * @param deviceId  The ID of the device to use (obtained from [requestDevice](#requestDevice) or [requestLEScan](#requestLEScan))\n   */\n  createBond(deviceId: string): Promise<void>;\n\n  /**\n   * Report whether a peripheral BLE device is bonded.\n   * Only available on **Android**. On iOS bonding is handled by the OS.\n   * @param deviceId  The ID of the device to use (obtained from [requestDevice](#requestDevice) or [requestLEScan](#requestLEScan))\n   */\n  isBonded(deviceId: string): Promise<boolean>;\n\n  /**\n   * Disconnect from a peripheral BLE device. For an example, see [usage](#usage).\n   * @param deviceId  The ID of the device to use (obtained from [requestDevice](#requestDevice) or [requestLEScan](#requestLEScan))\n   */\n  disconnect(deviceId: string): Promise<void>;\n\n  /**\n   * Get services, characteristics and descriptors of a device.\n   * @param deviceId  The ID of the device to use (obtained from [requestDevice](#requestDevice) or [requestLEScan](#requestLEScan))\n   */\n  getServices(deviceId: string): Promise<BleService[]>;\n\n  /**\n   * Read the RSSI value of a connected device.\n   * Not available on web.\n   * @param deviceId The ID of the device to use (obtained from [requestDevice](#requestDevice) or [requestLEScan](#requestLEScan))\n   */\n  readRssi(deviceId: string): Promise<number>;\n\n  /**\n   * Read the value of a characteristic. For an example, see [usage](#usage).\n   * @param deviceId The ID of the device to use (obtained from [requestDevice](#requestDevice) or [requestLEScan](#requestLEScan))\n   * @param service UUID of the service (see [UUID format](#uuid-format))\n   * @param characteristic UUID of the characteristic (see [UUID format](#uuid-format))\n   * @param options Options for plugin call\n   */\n  read(deviceId: string, service: string, characteristic: string, options?: TimeoutOptions): Promise<DataView>;\n\n  /**\n   * Write a value to a characteristic. For an example, see [usage](#usage).\n   * @param deviceId The ID of the device to use (obtained from [requestDevice](#requestDevice) or [requestLEScan](#requestLEScan))\n   * @param service UUID of the service (see [UUID format](#uuid-format))\n   * @param characteristic UUID of the characteristic (see [UUID format](#uuid-format))\n   * @param value The value to write as a DataView. To create a DataView from an array of numbers, there is a helper function, e.g. numbersToDataView([1, 0])\n   * @param options Options for plugin call\n   */\n  write(\n    deviceId: string,\n    service: string,\n    characteristic: string,\n    value: DataView,\n    options?: TimeoutOptions\n  ): Promise<void>;\n\n  /**\n   * Write a value to a characteristic without waiting for a response.\n   * @param deviceId The ID of the device to use (obtained from [requestDevice](#requestDevice) or [requestLEScan](#requestLEScan))\n   * @param service UUID of the service (see [UUID format](#uuid-format))\n   * @param characteristic UUID of the characteristic (see [UUID format](#uuid-format))\n   * @param value The value to write as a DataView. To create a DataView from an array of numbers, there is a helper function, e.g. numbersToDataView([1, 0])\n   * @param options Options for plugin call\n   */\n  writeWithoutResponse(\n    deviceId: string,\n    service: string,\n    characteristic: string,\n    value: DataView,\n    options?: TimeoutOptions\n  ): Promise<void>;\n\n  /**\n   * Read the value of a descriptor.\n   * @param deviceId The ID of the device to use (obtained from [requestDevice](#requestDevice) or [requestLEScan](#requestLEScan))\n   * @param service UUID of the service (see [UUID format](#uuid-format))\n   * @param characteristic UUID of the characteristic (see [UUID format](#uuid-format))\n   * @param descriptor UUID of the descriptor (see [UUID format](#uuid-format))\n   * @param options Options for plugin call\n   */\n  readDescriptor(\n    deviceId: string,\n    service: string,\n    characteristic: string,\n    descriptor: string,\n    options?: TimeoutOptions\n  ): Promise<DataView>;\n\n  /**\n   * Write a value to a descriptor.\n   * @param deviceId The ID of the device to use (obtained from [requestDevice](#requestDevice) or [requestLEScan](#requestLEScan))\n   * @param service UUID of the service (see [UUID format](#uuid-format))\n   * @param characteristic UUID of the characteristic (see [UUID format](#uuid-format))\n   * @param descriptor UUID of the descriptor (see [UUID format](#uuid-format))\n   * @param value The value to write as a DataView. To create a DataView from an array of numbers, there is a helper function, e.g. numbersToDataView([1, 0])\n   * @param options Options for plugin call\n   */\n  writeDescriptor(\n    deviceId: string,\n    service: string,\n    characteristic: string,\n    descriptor: string,\n    value: DataView,\n    options?: TimeoutOptions\n  ): Promise<void>;\n\n  /**\n   * Start listening to changes of the value of a characteristic.\n   * Note that you should only start the notifications once per characteristic in your app and share the data and\n   * not call `startNotifications` in every component that needs the data.\n   * For an example, see [usage](#usage).\n   * @param deviceId The ID of the device to use (obtained from [requestDevice](#requestDevice) or [requestLEScan](#requestLEScan))\n   * @param service UUID of the service (see [UUID format](#uuid-format))\n   * @param characteristic UUID of the characteristic (see [UUID format](#uuid-format))\n   * @param callback Callback function to use when the value of the characteristic changes\n   */\n  startNotifications(\n    deviceId: string,\n    service: string,\n    characteristic: string,\n    callback: (value: DataView) => void\n  ): Promise<void>;\n\n  /**\n   * Stop listening to the changes of the value of a characteristic. For an example, see [usage](#usage).\n   * @param deviceId The ID of the device to use (obtained from [requestDevice](#requestDevice) or [requestLEScan](#requestLEScan))\n   * @param service UUID of the service (see [UUID format](#uuid-format))\n   * @param characteristic UUID of the characteristic (see [UUID format](#uuid-format))\n   */\n  stopNotifications(deviceId: string, service: string, characteristic: string): Promise<void>;\n}\n\nclass BleClientClass implements BleClientInterface {\n  private scanListener: PluginListenerHandle | null = null;\n  private eventListeners = new Map<string, PluginListenerHandle>();\n  private queue = getQueue(true);\n\n  enableQueue() {\n    this.queue = getQueue(true);\n  }\n\n  disableQueue() {\n    this.queue = getQueue(false);\n  }\n\n  async initialize(options?: InitializeOptions): Promise<void> {\n    await this.queue(async () => {\n      await BluetoothLe.initialize(options);\n    });\n  }\n\n  /**\n   * Reports whether BLE is enabled on this device.\n   * Always returns `true` on **web**.\n   * @deprecated Use `isEnabled` instead.\n   */\n  async getEnabled(): Promise<boolean> {\n    return this.isEnabled();\n  }\n\n  async isEnabled(): Promise<boolean> {\n    const enabled = await this.queue(async () => {\n      const result = await BluetoothLe.isEnabled();\n      return result.value;\n    });\n    return enabled;\n  }\n\n  async enable(): Promise<void> {\n    await this.queue(async () => {\n      await BluetoothLe.enable();\n    });\n  }\n\n  async disable(): Promise<void> {\n    await this.queue(async () => {\n      await BluetoothLe.disable();\n    });\n  }\n\n  async startEnabledNotifications(callback: (value: boolean) => void): Promise<void> {\n    await this.queue(async () => {\n      const key = `onEnabledChanged`;\n      await this.eventListeners.get(key)?.remove();\n      const listener = await BluetoothLe.addListener(key, (result) => {\n        callback(result.value);\n      });\n      this.eventListeners.set(key, listener);\n      await BluetoothLe.startEnabledNotifications();\n    });\n  }\n\n  async stopEnabledNotifications(): Promise<void> {\n    await this.queue(async () => {\n      const key = `onEnabledChanged`;\n      await this.eventListeners.get(key)?.remove();\n      this.eventListeners.delete(key);\n      await BluetoothLe.stopEnabledNotifications();\n    });\n  }\n\n  async isLocationEnabled(): Promise<boolean> {\n    const enabled = await this.queue(async () => {\n      const result = await BluetoothLe.isLocationEnabled();\n      return result.value;\n    });\n    return enabled;\n  }\n\n  async openLocationSettings(): Promise<void> {\n    await this.queue(async () => {\n      await BluetoothLe.openLocationSettings();\n    });\n  }\n\n  async openBluetoothSettings(): Promise<void> {\n    await this.queue(async () => {\n      await BluetoothLe.openBluetoothSettings();\n    });\n  }\n\n  async openAppSettings(): Promise<void> {\n    await this.queue(async () => {\n      await BluetoothLe.openAppSettings();\n    });\n  }\n\n  async setDisplayStrings(displayStrings: DisplayStrings): Promise<void> {\n    await this.queue(async () => {\n      await BluetoothLe.setDisplayStrings(displayStrings);\n    });\n  }\n\n  async requestDevice(options?: RequestBleDeviceOptions): Promise<BleDevice> {\n    const result = await this.queue(async () => {\n      const device = await BluetoothLe.requestDevice(options);\n      return device;\n    });\n    return result;\n  }\n\n  async requestLEScan(options: RequestBleDeviceOptions, callback: (result: ScanResult) => void): Promise<void> {\n    await this.queue(async () => {\n      await this.scanListener?.remove();\n      this.scanListener = await BluetoothLe.addListener('onScanResult', (resultInternal: ScanResultInternal) => {\n        const result: ScanResult = {\n          ...resultInternal,\n          manufacturerData: this.convertObject(resultInternal.manufacturerData),\n          serviceData: this.convertObject(resultInternal.serviceData),\n          rawAdvertisement: resultInternal.rawAdvertisement\n            ? this.convertValue(resultInternal.rawAdvertisement)\n            : undefined,\n        };\n        callback(result);\n      });\n      await BluetoothLe.requestLEScan(options);\n    });\n  }\n\n  async stopLEScan(): Promise<void> {\n    await this.queue(async () => {\n      await this.scanListener?.remove();\n      this.scanListener = null;\n      await BluetoothLe.stopLEScan();\n    });\n  }\n\n  async getDevices(deviceIds: string[]): Promise<BleDevice[]> {\n    return this.queue(async () => {\n      const result = await BluetoothLe.getDevices({ deviceIds });\n      return result.devices;\n    });\n  }\n\n  async getConnectedDevices(services: string[]): Promise<BleDevice[]> {\n    return this.queue(async () => {\n      const result = await BluetoothLe.getConnectedDevices({ services });\n      return result.devices;\n    });\n  }\n\n  async connect(deviceId: string, onDisconnect?: (deviceId: string) => void, options?: TimeoutOptions): Promise<void> {\n    await this.queue(async () => {\n      if (onDisconnect) {\n        const key = `disconnected|${deviceId}`;\n        await this.eventListeners.get(key)?.remove();\n        const listener = await BluetoothLe.addListener(key, () => {\n          onDisconnect(deviceId);\n        });\n        this.eventListeners.set(key, listener);\n      }\n      await BluetoothLe.connect({ deviceId, ...options });\n    });\n  }\n\n  async createBond(deviceId: string): Promise<void> {\n    await this.queue(async () => {\n      await BluetoothLe.createBond({ deviceId });\n    });\n  }\n\n  async isBonded(deviceId: string): Promise<boolean> {\n    const isBonded = await this.queue(async () => {\n      const result = await BluetoothLe.isBonded({ deviceId });\n      return result.value;\n    });\n    return isBonded;\n  }\n\n  async disconnect(deviceId: string): Promise<void> {\n    await this.queue(async () => {\n      await BluetoothLe.disconnect({ deviceId });\n    });\n  }\n\n  async getServices(deviceId: string): Promise<BleService[]> {\n    const services = await this.queue(async () => {\n      const result = await BluetoothLe.getServices({ deviceId });\n      return result.services;\n    });\n    return services;\n  }\n\n  async readRssi(deviceId: string): Promise<number> {\n    const value = await this.queue(async () => {\n      const result = await BluetoothLe.readRssi({ deviceId });\n      return parseFloat(result.value);\n    });\n    return value;\n  }\n\n  async read(deviceId: string, service: string, characteristic: string, options?: TimeoutOptions): Promise<DataView> {\n    service = validateUUID(service);\n    characteristic = validateUUID(characteristic);\n    const value = await this.queue(async () => {\n      const result = await BluetoothLe.read({\n        deviceId,\n        service,\n        characteristic,\n        ...options,\n      });\n      return this.convertValue(result.value);\n    });\n    return value;\n  }\n\n  async write(\n    deviceId: string,\n    service: string,\n    characteristic: string,\n    value: DataView,\n    options?: TimeoutOptions\n  ): Promise<void> {\n    service = validateUUID(service);\n    characteristic = validateUUID(characteristic);\n    return this.queue(async () => {\n      if (!value?.buffer) {\n        throw new Error('Invalid data.');\n      }\n      let writeValue: DataView | string = value;\n      if (Capacitor.getPlatform() !== 'web') {\n        // on native we can only write strings\n        writeValue = dataViewToHexString(value);\n      }\n      await BluetoothLe.write({\n        deviceId,\n        service,\n        characteristic,\n        value: writeValue,\n        ...options,\n      });\n    });\n  }\n\n  async writeWithoutResponse(\n    deviceId: string,\n    service: string,\n    characteristic: string,\n    value: DataView,\n    options?: TimeoutOptions\n  ): Promise<void> {\n    service = validateUUID(service);\n    characteristic = validateUUID(characteristic);\n    await this.queue(async () => {\n      if (!value?.buffer) {\n        throw new Error('Invalid data.');\n      }\n      let writeValue: DataView | string = value;\n      if (Capacitor.getPlatform() !== 'web') {\n        // on native we can only write strings\n        writeValue = dataViewToHexString(value);\n      }\n      await BluetoothLe.writeWithoutResponse({\n        deviceId,\n        service,\n        characteristic,\n        value: writeValue,\n        ...options,\n      });\n    });\n  }\n\n  async readDescriptor(\n    deviceId: string,\n    service: string,\n    characteristic: string,\n    descriptor: string,\n    options?: TimeoutOptions\n  ): Promise<DataView> {\n    service = validateUUID(service);\n    characteristic = validateUUID(characteristic);\n    descriptor = validateUUID(descriptor);\n    const value = await this.queue(async () => {\n      const result = await BluetoothLe.readDescriptor({\n        deviceId,\n        service,\n        characteristic,\n        descriptor,\n        ...options,\n      });\n      return this.convertValue(result.value);\n    });\n    return value;\n  }\n\n  async writeDescriptor(\n    deviceId: string,\n    service: string,\n    characteristic: string,\n    descriptor: string,\n    value: DataView,\n    options?: TimeoutOptions\n  ): Promise<void> {\n    service = validateUUID(service);\n    characteristic = validateUUID(characteristic);\n    descriptor = validateUUID(descriptor);\n    return this.queue(async () => {\n      if (!value?.buffer) {\n        throw new Error('Invalid data.');\n      }\n      let writeValue: DataView | string = value;\n      if (Capacitor.getPlatform() !== 'web') {\n        // on native we can only write strings\n        writeValue = dataViewToHexString(value);\n      }\n      await BluetoothLe.writeDescriptor({\n        deviceId,\n        service,\n        characteristic,\n        descriptor,\n        value: writeValue,\n        ...options,\n      });\n    });\n  }\n\n  async startNotifications(\n    deviceId: string,\n    service: string,\n    characteristic: string,\n    callback: (value: DataView) => void\n  ): Promise<void> {\n    service = validateUUID(service);\n    characteristic = validateUUID(characteristic);\n    await this.queue(async () => {\n      const key = `notification|${deviceId}|${service}|${characteristic}`;\n      await this.eventListeners.get(key)?.remove();\n      const listener = await BluetoothLe.addListener(key, (event: ReadResult) => {\n        callback(this.convertValue(event?.value));\n      });\n      this.eventListeners.set(key, listener);\n      await BluetoothLe.startNotifications({\n        deviceId,\n        service,\n        characteristic,\n      });\n    });\n  }\n\n  async stopNotifications(deviceId: string, service: string, characteristic: string): Promise<void> {\n    service = validateUUID(service);\n    characteristic = validateUUID(characteristic);\n    await this.queue(async () => {\n      const key = `notification|${deviceId}|${service}|${characteristic}`;\n      await this.eventListeners.get(key)?.remove();\n      this.eventListeners.delete(key);\n      await BluetoothLe.stopNotifications({\n        deviceId,\n        service,\n        characteristic,\n      });\n    });\n  }\n\n  private convertValue(value?: Data): DataView {\n    if (typeof value === 'string') {\n      return hexStringToDataView(value);\n    } else if (value === undefined) {\n      return new DataView(new ArrayBuffer(0));\n    }\n    return value;\n  }\n\n  private convertObject(obj?: { [key: string]: Data }): { [key: string]: DataView } | undefined {\n    if (obj === undefined) {\n      return undefined;\n    }\n    const result: { [key: string]: DataView } = {};\n    for (const key of Object.keys(obj)) {\n      result[key] = this.convertValue(obj[key]);\n    }\n    return result;\n  }\n}\n\nexport const BleClient = new BleClientClass();\n"]}